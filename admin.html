<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel | KPI</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="style.css">

<style>
.login-wrapper{
height:100vh;display:flex;flex-direction:column;
justify-content:center;align-items:center;
background:radial-gradient(circle,#1a1a1a 0%,#000 100%)
}
.login-box{
background:rgba(255,255,255,.05);
padding:40px;border-radius:15px;
border:1px solid rgba(255,255,255,.1);
backdrop-filter:blur(10px);
width:90%;max-width:400px;text-align:center
}
</style>
</head>

<body>

<video id="bg-video" autoplay muted loop playsinline>
<source src="https://raw.githubusercontent.com/gataubroicape-droid/dat2/main/uploads/06071b-1766158674257.mp4" type="video/mp4">
</video>

<!-- LOGIN -->
<div id="login-view" class="login-wrapper">
<h2 style="margin-bottom:20px;">Restricted Area</h2>
<div class="login-box">
<h3 style="color:var(--primary);margin-bottom:20px;">Admin Login</h3>
<form id="loginForm">
<input type="email" id="email" placeholder="Email Admin" required>
<input type="password" id="password" placeholder="Password" required>
<button class="btn-submit" id="btnLogin">Masuk</button>
</form>
<p id="loginError" style="color:red;display:none;margin-top:10px;"></p>
</div>
</div>

<!-- DASHBOARD -->
<div id="dashboard-view" style="display:none">
<div class="main-content" style="margin-left:0;padding-top:40px">

<div style="display:flex;justify-content:space-between;padding:0 5%">
<h2>Admin Dashboard</h2>
<button onclick="logout()">Logout</button>
</div>

<div class="admin-nav">
<button class="filter-btn active" onclick="showForm('member')">Members</button>
<button class="filter-btn" onclick="showForm('announce')">Announcement</button>
<button class="filter-btn" onclick="showForm('materi')">Materi (PPT)</button>
<a href="index.html" class="filter-btn">View Site</a>
</div>

<!-- MEMBER -->
<div id="member-section" class="admin-container">
<h3>Add Member</h3>
<form id="memberForm">
<input id="mName" placeholder="Nama" required>
<input id="mAge" type="number" placeholder="Umur" required>
<select id="mGender"><option>♂️</option><option>♀️</option></select>
<select id="mRole"><option>member</option><option>admin</option></select>
<input id="mAvatar" placeholder="Avatar URL" required>
<input id="mGames" placeholder="Game:ID" required>
<input id="mSocials" placeholder="Sosmed">
<button class="btn-submit">Simpan</button>
</form>
<div id="admin-member-list"></div>
</div>

<!-- ANNOUNCE -->
<div id="announce-section" class="admin-container" style="display:none">
<h3>Add Announcement</h3>
<form id="announceForm">
<input id="aTitle" placeholder="Judul" required>
<input id="aDate" placeholder="Tanggal" required>
<textarea id="aDesc" placeholder="Deskripsi" required></textarea>
<button class="btn-submit">Post</button>
</form>
<div id="admin-announce-list"></div>
</div>

<!-- MATERI -->
<div id="materi-section" class="admin-container" style="display:none">
<h3>Add Materi (PPT)</h3>
<form id="materiForm">
<input id="mMateriName" placeholder="Materi 1" required>
<input id="mMateriTitle" placeholder="Judul Materi" required>
<textarea id="mMateriContent" placeholder="Pengertian / Isi" required></textarea>
<button class="btn-submit">Simpan Materi</button>
</form>
<div id="admin-materi-list"></div>
</div>

</div>
</div>

<script type="module">
import { db, auth } from './config.js'
import { collection, addDoc, onSnapshot, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
import { signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"

onAuthStateChanged(auth,(user)=>{
document.getElementById('login-view').style.display=user?'none':'flex'
document.getElementById('dashboard-view').style.display=user?'block':'none'
})

loginForm.onsubmit=e=>{
e.preventDefault()
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(()=>loginError.style.display='block')
}

window.logout=()=>signOut(auth)

window.showForm=t=>{
['member','announce','materi'].forEach(x=>{
document.getElementById(x+'-section').style.display=t===x?'block':'none'
})
}

memberForm.onsubmit=async e=>{
e.preventDefault()
await addDoc(collection(db,"members"),{
name:mName.value,age:mAge.value,gender:mGender.value,
role:mRole.value,avatar:mAvatar.value,
games:mGames.value,socials:mSocials.value
})
memberForm.reset()
}

announceForm.onsubmit=async e=>{
e.preventDefault()
await addDoc(collection(db,"announcements"),{
title:aTitle.value,date:aDate.value,
desc:aDesc.value,type:"info"
})
announceForm.reset()
}

materiForm.onsubmit=async e=>{
e.preventDefault()
await addDoc(collection(db,"announcements"),{
materiName:mMateriName.value,
title:mMateriTitle.value,
content:mMateriContent.value,
type:"materi"
})
materiForm.reset()
}

onSnapshot(collection(db,"announcements"),snap=>{
admin-announce-list.innerHTML=''
admin-materi-list.innerHTML=''
snap.forEach(d=>{
let x=d.data()
if(x.type==="info")
admin-announce-list.innerHTML+=`<div>${x.title}<button onclick="deleteItem('announcements','${d.id}')">X</button></div>`
if(x.type==="materi")
admin-materi-list.innerHTML+=`<div>${x.materiName} - ${x.title}<button onclick="deleteItem('announcements','${d.id}')">X</button></div>`
})
})

window.deleteItem=(c,id)=>deleteDoc(doc(db,c,id))
</script>

</body>
</html>                                            
